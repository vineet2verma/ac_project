<div class="modal fade" id="orderModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add New Order</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="post" data-loader-text="Saving order, please waitâ€¦" enctype="multipart/form-data"
                      action="{% url 'cnc_work_app:add_order' %}">
                    {% csrf_token %}
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Title</label>
                            <input class="form-control" type="text" name="title" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Stone</label>
                            <input class="form-control" type="text" name="stone" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Color</label>
                            <input class="form-control" type="text" name="color" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Approval Date</label>
                            <input class="form-control" type="date" name="approval_date" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Expected Delivery</label>
                            <input class="form-control" type="date" name="exp_delivery_date" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Coverage Area</label>
                            <input class="form-control" type="text" name="coverage_area" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Party Name</label>
                            <input class="form-control" type="text" name="party_name" required>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label fw-semibold">Packing Instruction</label>

                            <div class="dropdown">
                                <button class="form-control text-start d-flex justify-content-between align-items-center"
                                        type="button"
                                        data-bs-toggle="dropdown"
                                        aria-expanded="false"
                                        id="packingDropdownBtn">
                                    <span id="packingDropdownText" class="text-muted">
                                        Select packing instruction
                                    </span>
                                    <i class="bi bi-chevron-down"></i>
                                </button>

                                <ul class="dropdown-menu w-100 p-2 shadow-sm">
                                    <li class="dropdown-item">
                                        <div class="form-check">
                                            <input class="form-check-input packing-check" type="checkbox"
                                                   name="packing_instruction[]" value="Thermocol Pack" id="pack1">
                                            <label class="form-check-label" for="pack1">
                                                Thermocol Pack
                                            </label>
                                        </div>
                                    </li>

                                    <li class="dropdown-item">
                                        <div class="form-check">
                                            <input class="form-check-input packing-check" type="checkbox"
                                                   name="packing_instruction[]" value="Gatta Pack" id="pack2">
                                            <label class="form-check-label" for="pack2">
                                                Gatta Pack
                                            </label>
                                        </div>
                                    </li>

                                    <li class="dropdown-item">
                                        <div class="form-check">
                                            <input class="form-check-input packing-check" type="checkbox"
                                                   name="packing_instruction[]" value="Pallete Pack" id="pack3">
                                            <label class="form-check-label" for="pack3">
                                                Pallete Pack
                                            </label>
                                        </div>
                                    </li>

                                    <li class="dropdown-item">
                                        <div class="form-check">
                                            <input class="form-check-input packing-check" type="checkbox"
                                                   name="packing_instruction[]" value="Bubble Pack" id="pack4">
                                            <label class="form-check-label" for="pack4">
                                                Bubble Pack
                                            </label>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="col-md-4">
                                <label class="form-label">Sales Person</label>
                                <select class="form-select" name="sales_person" required>
                                    <option value="">Select Sales Person</option>

                                    {% for u in sales_users %}
                                    <option value="{{ u.username }}">
                                        {{ u.full_name|default:u.username }}
                                    </option>
                                    {% endfor %}
                                </select>
                        </div>
                        <div class="col-md-4 col-12">
                            <label class="form-label">Type of Work</label>
                            <select class="form-select" name="type_of_work" required>
                                <option value="">Select Type of Work</option>
                                <option value="CNC Work">CNC Work</option>
                                <option value="Third Fire">Third Fire</option>
                                <option value="Sand Blasting">Sand Blasting</option>
                                <option value="Tile Cutting">Tile Cutting</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">Remarks</label>
                            <input class="form-control" type="text" name="remarks" placeholder="Mention Height & Weight / Remarks" required>
                        </div>
                        <div class="col-6">
                            <label class="form-label">Upload Image</label>
                            <input class="form-control" type="file" name="image" required>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button type="submit" class="btn btn-success w-100">Save Order</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
<!--  Packing Instruction  -->
document.querySelectorAll('.packing-check').forEach(cb => {
    cb.addEventListener('change', () => {
        const checked = Array.from(
            document.querySelectorAll('.packing-check:checked')
        ).map(el => el.value);

        document.getElementById('packingDropdownBtn').innerText =
            checked.length ? checked.join(', ') : 'Select Packing Instruction';
    });
});
</script>