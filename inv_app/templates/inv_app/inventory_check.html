{% extends "base.html" %}
{% block title %}Inventory Check{% endblock %}
{% block content %}

<div class="container-fluid py-3">
    
    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Inventory Check</h5>
        
        <!-- BACK TO ORDER -->
        <a href="{% url 'cnc_work_app:detail' order_id %}"
           class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left"></i> Back to Order
        </a>
    </div>
    
    <table class="table table-sm table-bordered">
        <thead class="table-light">
        <tr>
            <th>Item</th>
            <th class="text-end">Required</th>
            <th class="text-end">Available</th>
            <th class="text-end">Shortage</th>
            <th>Status</th>
            <th width="150">Action</th>
        </tr>
        </thead>
        <tbody>
        
        {% for r in records %}
        <tr>
            <td>{{ r.item_name }}</td>
            <td class="text-end">{{ r.required_qty }}</td>
            <td class="text-end">{{ r.available_qty }}</td>
            <td class="text-end">{{ r.shortage_qty|default:"-" }}</td>
            <td>{{ r.status_calc }}</td>
            <td class="text-center">
                
                {% if r.status_calc == "AVAILABLE" %}
                <form method="POST"
                      action="{% url 'inv_app:inventory_reserve' r.id %}">
                    {% csrf_token %}
                    <button class="btn btn-primary btn-sm">
                        ðŸ”’ Reserve
                    </button>
                </form>
                
                {% elif r.status_calc == "SHORTAGE" %}
                <form method="POST"
                      action="{% url 'inv_app:create_pr' r.id %}">
                    {% csrf_token %}
                    <button class="btn btn-warning btn-sm">
                        ðŸ›’ Create PR
                    </button>
                </form>
                
                {% elif r.status_calc == "RESERVED" %}
                <span class="badge bg-primary">
        ðŸ”’ Reserved
    </span>
                
                {% elif r.status_calc == "CONSUMED" %}
                <span class="badge bg-dark">
        âœ” Issued
    </span>
                
                {% else %}
                <span class="text-muted">Locked</span>
                
                {% endif %}
            
            </td>
        </tr>
        {% endfor %}
        
        </tbody>
    </table>

</div>
{% endblock %}
