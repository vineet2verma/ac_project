{% extends "base.html" %}
{% block title %}Low Stock Alert{% endblock %}
{% block content %}

<div class="container-fluid py-3">

<form method="POST">
{% csrf_token %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0 text-danger">
        <i class="bi bi-exclamation-triangle-fill"></i> Low Stock Alert
    </h5>

    <div class="d-flex gap-2">
        <button formaction="{% url 'inv_app:create_pr_selected' %}"
                class="btn btn-danger btn-sm"
                onclick="return confirm('Create PR for selected items?');">
            Create PR
        </button>

        <button formaction="{% url 'inv_app:download_low_stock_excel' %}"
                class="btn btn-outline-primary btn-sm">
            Download Excel
        </button>

        <a href="{% url 'inv_app:inventory_master' %}"
           class="btn btn-outline-secondary btn-sm">
            Back
        </a>
    </div>
</div>

<div class="table-responsive">
<table class="table table-sm table-bordered align-middle">
<thead class="table-light">
<tr>
    <th width="40">
        <input type="checkbox" id="selectAll">
    </th>
    <th>Item</th>
    <th>Unit</th>
    <th class="text-end">Stock</th>
    <th class="text-end">Reorder</th>
    <th class="text-end">Required</th>
</tr>
</thead>

<tbody>
{% for i in items %}
<tr class="table-danger">
    <td class="text-center">
        <input type="checkbox"
               name="item_ids"
               value="{{ i.id }}"
               class="row-check">
    </td>
    <td>{{ i.item_name }}</td>
    <td>{{ i.unit }}</td>
    <td class="text-end fw-bold">{{ i.current_qty }}</td>
    <td class="text-end">{{ i.reorder_level }}</td>
    <td class="text-end fw-bold">
        {{ i.reorder_level|floatformat:2|add:""|floatformat:2 }}
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="6" class="text-center text-muted">
        No low stock items
    </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

</form>
</div>

<script>
document.getElementById("selectAll").addEventListener("change", function () {
    document.querySelectorAll(".row-check").forEach(cb => {
        cb.checked = this.checked;
    });
});
</script>

{% endblock %}
